# Risk Management Configuration for Hierarchical Blockchain Framework
# This file defines comprehensive risk thresholds, mitigation strategies, and monitoring

# Framework Information
framework:
  description: "Risk management configuration defining risk thresholds, mitigation strategies, and monitoring for the hierarchical blockchain framework"

# Risk Management Configuration
risk_management:
  # Consensus Risk Configuration
  consensus:
    bft:
      min_nodes: 4                    # Minimum nodes for BFT consensus (n >= 3f + 1 with f=1)
      fault_tolerance: 1              # Maximum faulty nodes tolerated
      message_verification: "strict"  # Message verification level
      heartbeat_timeout: 500          # Heartbeat timeout in milliseconds
      election_timeout: 10000         # Leader election timeout in milliseconds
    
    performance:
      max_leader_timeout: 30          # Maximum leader timeout in seconds
      max_message_delay: 5.0          # Maximum message processing delay in seconds
      min_consensus_rate: 95.0        # Minimum consensus success rate percentage
      max_round_time: 10.0            # Maximum consensus round time in seconds
  
  # Security Risk Configuration
  security:
    msp:
      certificate_lifetimes:
        root: 3650                       # Root certificate lifetime in days (10 years)
        intermediate: 1825               # Intermediate certificate lifetime in days (5 years)
        entity: 365                      # Entity certificate lifetime in days (1 year)
      revocation_check: "daily"          # Certificate revocation check frequency
      revocation_check_interval: 86400   # Revocation check interval in seconds (24 hours)
    
    private_data:
      encryption: "AES-256-GCM"          # Encryption algorithm for private data
      access_policy: "MAJORITY_APPROVAL" # Access policy for private collections
      performance_threshold: 1000        # Maximum private data operations per block
      key_rotation_interval: 2592000     # Key rotation interval in seconds (30 days)
    
    authentication:
      max_failed_attempts: 5          # Maximum failed authentication attempts
      lockout_duration: 1800          # Account lockout duration in seconds (30 minutes)
      session_timeout: 3600           # Session timeout in seconds (1 hour)
      password_complexity: "high"     # Password complexity requirement
  
  # Performance Risk Configuration
  performance:
    ordering_service:
      batch_size: 250                  # Transaction batch size
      batch_timeout: 2.0               # Batch timeout in seconds
      pool_limit: 10000                # Maximum transaction pool size
      max_inflight_transactions: 10000 # Maximum in-flight transactions
    
    caching:
      eviction_policy: "LRU"          # Cache eviction policy
      max_size: 50000                 # Maximum cache entries
      memory_limit: "2GB"             # Maximum cache memory usage
      hit_rate_threshold: 80.0        # Minimum cache hit rate percentage
    
    system_thresholds:
      cpu_warning: 80.0                   # CPU usage warning threshold (percentage)
      cpu_critical: 90.0                  # CPU usage critical threshold (percentage)
      memory_warning: 85.0                # Memory usage warning threshold (percentage)
      memory_critical: 95.0               # Memory usage critical threshold (percentage)
      disk_warning: 80.0                  # Disk usage warning threshold (percentage)
      disk_critical: 90.0                 # Disk usage critical threshold (percentage)
      network_connections_warning: 1000   # Network connections warning threshold
      network_connections_critical: 2000  # Network connections critical threshold
  
  # Storage Risk Configuration
  storage:
    world_state:
      update_frequency: "per_block"   # World state update frequency
      backup_interval: 3600           # Backup interval in seconds (hourly)
      query_optimization: "indexed"   # Query optimization strategy
      max_size: 1000000               # Maximum world state entries
      compression: true               # Enable compression
    
    blockchain_data:
      retention_policy: "unlimited"   # Data retention policy
      archive_threshold: 1000000      # Archive threshold in blocks
      backup_retention: 90            # Backup retention in days
      integrity_check_interval: 86400 # Integrity check interval in seconds (daily)
  
  # Operational Risk Configuration
  operational:
    multi_org:
      sync_interval: 300                    # Multi-org sync interval in seconds (5 minutes)
      conflict_resolution: "priority_based" # Conflict resolution strategy
      max_sync_failures: 3                  # Maximum sync failures before alert
      heartbeat_timeout: 60                 # Organization heartbeat timeout in seconds
    
    channels:
      member_policy: "ADMIN_APPROVAL" # Channel member addition policy
      read_write_policy: "ROLE_BASED" # Read/write access policy
      max_members_per_channel: 50     # Maximum members per channel
      channel_timeout: 30             # Channel operation timeout in seconds
    
    tracing:
      max_events: 100000              # Maximum events to trace
      accuracy_threshold: 99.9        # Tracing accuracy threshold percentage
      trace_retention: 30             # Trace retention in days
      indexing_strategy: "timestamp_entity" # Tracing index strategy
    
    contracts:
      version_control: "semantic"      # Contract version control strategy
      upgrade_policy: "zero_downtime"  # Contract upgrade policy
      execution_isolation: "sandboxed" # Contract execution isolation level
      max_execution_time: 30           # Maximum contract execution time in seconds
      max_version_history: 10          # Maximum versions to retain

# Risk Mitigation Configuration
mitigation:
  # Automated Testing Configuration
  testing:
    automated: true                  # Enable automated testing
    coverage_target: 90              # Test coverage target percentage
    performance_tests: true          # Enable performance testing
    security_tests: true             # Enable security testing
    integration_tests: true          # Enable integration testing
  
  # Monitoring and Alerting Configuration
  monitoring:
    enable_real_time: true           # Enable real-time monitoring
    collection_interval: 5.0         # Metrics collection interval in seconds
    data_retention: 30               # Monitoring data retention in days
    
    alert_thresholds:
      cpu: 80                        # CPU usage alert threshold (percentage)
      memory: 90                     # Memory usage alert threshold (percentage)
      disk: 85                       # Disk usage alert threshold (percentage)
      network: 80                    # Network usage alert threshold (percentage)
      error_rate: 5                  # Error rate alert threshold (percentage)
      response_time: 5.0             # Response time alert threshold in seconds
    
    alert_escalation:
      enable: true                   # Enable alert escalation
      escalation_time: 1800          # Escalation time in seconds (30 minutes)
      max_escalation_level: 3        # Maximum escalation levels
      cooldown_period: 300           # Cooldown period between alerts in seconds
    
    notifications:
      email:
        enabled: false               # Email notifications (disabled by default)
        smtp_server: "localhost"
        smtp_port: 587
        from_email: "alerts@blockchain.local"
        recipients: []               # Email recipients list
      
      webhook:
        enabled: false              # Webhook notifications (disabled by default)
        url: ""                     # Webhook URL
        timeout: 10                 # Webhook timeout in seconds
        retry_attempts: 3           # Number of retry attempts
  
  # Backup and Recovery Configuration
  backup:
    automatic_backup: true           # Enable automatic backups
    backup_interval: 3600            # Backup interval in seconds (hourly)
    backup_retention: 90             # Backup retention in days
    backup_compression: true         # Enable backup compression
    backup_encryption: true          # Enable backup encryption
    recovery_testing: true           # Enable recovery testing
    
    storage_locations:
      primary: "/backup/blockchain"  # Primary backup location
      secondary: ""                  # Secondary backup location (optional)
      cloud: ""                      # Cloud backup location (optional)
  
  # Incident Response Configuration
  incident_response:
    enable_auto_response: true       # Enable automated incident response
    response_timeout: 300            # Response timeout in seconds (5 minutes)
    escalation_chain: []             # Incident escalation chain
    
    auto_mitigation:
      consensus_failures: true       # Auto-mitigate consensus failures
      security_breaches: true        # Auto-mitigate security breaches
      performance_issues: true       # Auto-mitigate performance issues
      storage_issues: true           # Auto-mitigate storage issues

# Risk Assessment Configuration
assessment:
  # Risk Scoring Configuration
  scoring:
    methodology: "CVSS_based"        # Risk scoring methodology
    factors:
      impact: 0.4                    # Impact weight in scoring
      likelihood: 0.3                # Likelihood weight in scoring
      exploitability: 0.3            # Exploitability weight in scoring
    
    severity_levels:
      low: [0.0, 3.9]               # Low severity score range
      medium: [4.0, 6.9]            # Medium severity score range
      high: [7.0, 8.9]              # High severity score range
      critical: [9.0, 10.0]         # Critical severity score range
  
  # Risk Categories
  categories:
    technical:
      consensus_risks: 0.9           # Consensus risk multiplier
      security_risks: 1.0            # Security risk multiplier
      performance_risks: 0.7         # Performance risk multiplier
      storage_risks: 0.8             # Storage risk multiplier
    
    operational:
      multi_org_risks: 0.6           # Multi-organization risk multiplier
      channel_risks: 0.5             # Channel management risk multiplier
      tracing_risks: 0.4             # Entity tracing risk multiplier
      contract_risks: 0.7            # Domain contract risk multiplier

# Compliance and Audit Configuration
compliance:
  # Audit Logging Configuration
  audit:
    enable: true                    # Enable audit logging
    log_level: "DEBUG"              # Audit log level
    retention_period: 365           # Audit log retention in days
    log_rotation: "daily"           # Log rotation frequency
    max_log_size: "100MB"           # Maximum log file size
    compression: true               # Enable log compression
    
    events_to_log:
      - "risk_detection"
      - "mitigation_execution"
      - "consensus_events"
      - "security_events"
      - "performance_events"
      - "user_actions"
      - "configuration_changes"
      - "access_events"
  
  # Regulatory Compliance
  regulatory:
    framework: "general"            # Regulatory framework (general, GDPR, HIPAA, etc.)
    data_protection: true           # Enable data protection measures
    right_to_erasure: false         # Enable right to erasure (blockchain limitations)
    audit_trail_integrity: true     # Maintain audit trail integrity
    
    reporting:
      enable_automated_reports: true  # Enable automated compliance reports
      report_frequency: "monthly"     # Report generation frequency
      report_retention: 365           # Report retention in days
      report_formats: ["json", "pdf"] # Supported report formats

# Performance Optimization Configuration
optimization:
  # Database Optimization
  database:
    connection_pooling: true        # Enable connection pooling
    max_connections: 100            # Maximum database connections
    query_timeout: 30               # Query timeout in seconds
    index_optimization: true        # Enable index optimization
    vacuum_interval: 86400          # Database vacuum interval in seconds (daily)
  
  # Network Optimization
  network:
    compression: true               # Enable network compression
    keep_alive: true                # Enable TCP keep-alive
    max_concurrent_requests: 1000   # Maximum concurrent network requests
    timeout: 30                     # Network timeout in seconds
    retry_attempts: 3               # Network retry attempts
  
  # Memory Optimization
  memory:
    garbage_collection: "automatic" # Garbage collection strategy
    memory_pool_size: "1GB"         # Memory pool size
    cache_optimization: true        # Enable cache optimization
    memory_monitoring: true         # Enable memory monitoring

# Development and Testing Configuration
development:
  # Static Analysis Configuration
  static_analysis:
    enable: true                   # Enable static analysis
    tools: ["custom", "bandit"]    # Static analysis tools
    severity_threshold: "medium"   # Minimum severity to report
    exclude_patterns:              # Patterns to exclude from analysis
      - "__pycache__"
      - ".git"
      - ".venv"
      - "venv"
      - "node_modules"
  
  # Testing Configuration
  testing:
    unit_tests: true              # Enable unit tests
    integration_tests: true       # Enable integration tests
    performance_tests: true       # Enable performance tests
    security_tests: true          # Enable security tests
    coverage_reporting: true      # Enable coverage reporting
    test_data_cleanup: true       # Enable test data cleanup

# Version-specific Configuration
version_config:
  upgrade_path: "0.dev4_to_0.dev5" # Upgrade path identifier
  compatibility:
    backward_compatible: true      # Backward compatibility
    forward_compatible: false      # Forward compatibility (N/A for dev versions)
  
  changelog:
    - "Added comprehensive risk management and mitigation system"
    - "Implemented automated testing and static analysis capabilities"
    - "Enhanced performance monitoring with fallback implementations"
    - "Added real-time alerting and anomaly detection"
    - "Improved audit logging and compliance reporting"
    - "Updated configuration management for risk profiles"